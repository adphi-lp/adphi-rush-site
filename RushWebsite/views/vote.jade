extends layout

block head
  title='Voting'
  link(rel='stylesheet',href=basepath+'/css/vote.css')
  script(type='text/javascript',src=basepath+'/js/vendor/jquery-1.8.3.min.js')
  script(type='text/javascript',src=basepath+'/js/vote.js')

block content
  .rushee-wrapper
    .rushee-content.clearfix
      rushee-photo-and-status.lfloat
        a.rushee-photo(href=basepath+'/vote?rID='+rushee._id)
          img.img-large(src=basepath+rushee.photo,alt=rushee.name)
        .rushee-status #{rushee.status.type.name}
        -if (rushee.priority)
          .rushee-priority Priority
      .rushee-info
        .rushee-info-item.rushee-name
          a(href='vote?rID='+rushee._id) #{rushee.name}
        .rushee-info-item.rushee-dorm
          span.rushee-info-type Dorm
          span.rushee-info-data #{rushee.dorm}
        .rushee-info-item.rushee-phone
          span.rushee-info-type Phone
          span.rushee-info-data #{rushee.phone}
        .rushee-info-item.rushee-email
          span.rushee-info-type Email
          span.rushee-info-data #{rushee.email}
        .rushee-info-item.rushee-year
          span.rushee-info-type Year
          span.rushee-info-data #{rushee.year}
        .rushee-info-item.rushee-sponsors
          span.rushee-info-type Sponsor(s)
          - if (rushee.sponsors.length > 0)
            span.rushee-info-data #{rushee.sponsorsList.join(', ')}
          - else
            span.rushee-info-data.missing-sponsor NEED SPONSOR
        .rushee-info-item.rushee-votes
          span.rushee-info-type Voting score
          span.rushee-info-data #{rushee.vote}
        .rushee-edit
          a(href=basepath+'/editrushee?rID='+rushee._id) edit
        
  .brother-action-wrapper
    form.brother-action-content
      input(type='hidden',name='rID',value='#{rushee._id}')
      -if (brother == null)
        .brother-wrapper
          span.brother-action-type Name
          select.brother-list#brothers(name='bID')
            -for (var i = 0; i < brothers.length; i++)
              -var b = brothers[i];
              option(value='#{b._id}') #{b.lastfirst}
         button#brother-select-button(formmethod='get',formaction=basepath+'/vote',value='Select') Select
      -else
        input(type='hidden',name='bID',value='#{brother._id}')
        .brother-wrapper
          span.brother-action-type Name
          span.brother-info#brother-name #{brother.name}
        .sponsor-wrapper
          .sponsor-content
            span.brother-action-type Sponsor
            -if (brother.sponsor)
              input.span-space#sponsorYes(type='radio',name='sponsor',value='Yes',checked)
              label.sponsor-choice(for='sponsorYes') Yes
              input.span-space#sponsorNo(type='radio',name='sponsor',value='No')
              label.sponsor-choice(for='sponsorNo') No
            -else
              input.span-space#sponsorYes(type='radio',name='sponsor',value='Yes')
              label.sponsor-choice(for='sponsorYes') Yes
              input.span-space#sponsorNo(type='radio',name='sponsor',value='No',checked)
              label.sponsor-choice(for='sponsorNo') No
        .vote-wrapper
          .vote-content
            span.brother-action-type Vote
            - for (var i = 0; i < voteTypes.length; i++)
              - var voteType = voteTypes[i];
              - var bid = brother.vote.type._id;
              - var vid = voteType._id;
              - if (bid === vid)
                input.span-space(id = 'vote#{i}',type='radio',name='vote',value='#{voteType._id}',checked)
              -else
                input.span-space(id = 'vote#{i}', type='radio',name='vote',value='#{voteType._id}')
              label.vote-choice(for ='vote#{i}') #{voteType.name}
        .comment-wrapper
          .comment-content.clearfix
            span.brother-action-type Comment (optional)
            .comment-textarea-wrapper
              textarea#comment-textarea(name='comment',rows=5,cols=60)
            .comment-type
              .comment-type.lfloat
                span.brother-action-type Type
                select#comment-type(name='commentType')
                  -for (var i = 0; i < commentTypes.length; i++)
                    option(value='#{commentTypes[i]._id}') #{commentTypes[i].name}
              //
                .comment-jaunt.rfloat
                  span.brother-action-type Jaunt
                  select#comment-jaunt(name='commentJaunt')
                    -for (var i in jaunts)
                      option(value='#{jaunts[i]}') #{jaunts[i]}
        .post-wrapper
          input#save(type='submit',formmethod='post',formaction=basepath+'/vote',value='Submit')
          input#done(type='submit',formmethod='get',formaction=basepath+'/',value='Back to rushees')
             
  .votes-wrapper
    h2.title Votes
    button.votes-button.spoiler-button(type='button') Show/hide
    .votes-content.spoiler-content
      table.votes-table
        tr.votes-header-row
          th.votes-header-name Brother Name
          -for (var i = 0; i < voteTypes.length; i++)
            -var voteType = voteTypes[i];
            th.votes-header-cell #{voteType.name}
         -for (var i = 0; i < rushee.votesByType.length; i++)
            -var vote = rushee.votesByType[i]
            -var bid = vote.type._id;
            tr.votes-row
            td.votes-name #{vote.brother.name}
              -for (var j = 0; j < voteTypes.length; j++)
                -var voteType = voteTypes[j];
                -var vid = voteType._id;
                -if (bid == vid)
                  td.votes-cell
                    strong X
                -else
                  td.votes-cell
         
  .comment-thread-wrapper
    h2.title Comments
    ul.comment-thread-content
      - for (var i = 0; i < rushee.comments.length; i++)	
        -var comment = rushee.comments[i];
        li.comment-wrapper
          .comment-content
            .comment-header
              span.comment-header-element.comment-name #{comment.brother.name}
              span.comment-header-element.type(style='color:#{comment.type.color};') #{comment.type.name}
            .comment-text #{comment.text}
            .comment-time #{comment.time}


 